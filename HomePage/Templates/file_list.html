<!-- Search Box -->
<input type="text" id="searchInput" placeholder="Search by title, name, or file type..."
       style="width: 100%; padding: 10px; margin-bottom: 15px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;">
       
<div style="margin-bottom: 15px;">
  <button id="resetButton" style="padding: 8px 15px; font-size: 14px;">Reset Filters</button>
</div>


<table border="1" cellspacing="0" cellpadding="8" style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr>
      <th onclick="sortTable(0)">Title ▲▼</th>
      <th onclick="sortTable(1)">Name ▲▼</th>
      <th onclick="sortTable(2)">Upload Date ▲▼</th>
      <th>File Type</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="fileTableBody">
    {% for file in files %}
    <tr>
      <td>{{ file.title }}</td>
      <td>{{ file.name }}</td>
      <td>{{ file.uploaded_at|date:"Y-m-d H:i:s" }}</td> <!-- Use sortable format -->
      <td>{{ file.file.name|slice:"-3"|upper }}</td>
      <td>
        <a href="{{ file.file.url }}" target="_blank" download>View / Download</a> |
        <form action="{% url 'delete_file' file.id %}" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit" onclick="return confirm('Are you sure you want to delete this file?');">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
 const searchInput = document.getElementById('searchInput');
  const tableBody = document.getElementById('fileTableBody');
  const resetButton = document.getElementById('resetButton');

  // Clone original table rows on page load
  const originalRows = Array.from(tableBody.rows).map(row => row.cloneNode(true));

  // Search Feature
  searchInput.addEventListener('input', function () {
    const filter = searchInput.value.toLowerCase();

    Array.from(tableBody.rows).forEach(row => {
      const title = row.cells[0].textContent.toLowerCase();
      const name = row.cells[1].textContent.toLowerCase();
      const fileType = row.cells[3].textContent.toLowerCase();
      const combined = title + ' ' + name + ' ' + fileType;

      row.style.display = combined.includes(filter) ? '' : 'none';
    });
  });

  // Sorting Feature
  let sortDirection = [true, true, true]; // true = asc, false = desc

  function sortTable(columnIndex) {
    const rowsArray = Array.from(tableBody.rows);
    const asc = sortDirection[columnIndex];
    rowsArray.sort((a, b) => {
      let aText = a.cells[columnIndex].textContent.trim();
      let bText = b.cells[columnIndex].textContent.trim();

      if (columnIndex === 2) {
        return asc
          ? new Date(aText) - new Date(bText)
          : new Date(bText) - new Date(aText);
      }

      return asc
        ? aText.localeCompare(bText)
        : bText.localeCompare(aText);
    });

    rowsArray.forEach(row => tableBody.appendChild(row));
    sortDirection[columnIndex] = !asc;
  }

  // Reset Feature
  resetButton.addEventListener('click', function () {
    searchInput.value = ''; // Clear search input
    tableBody.innerHTML = ''; // Clear table

    // Restore original rows
    originalRows.forEach(row => tableBody.appendChild(row.cloneNode(true)));
  });
</script>
